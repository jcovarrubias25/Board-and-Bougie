<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Charcuterie Challenge</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#7a5cfa">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <style>
        :root { --primary: #7a5cfa; --wood: #d2b48c; --bark: #bc9d70; }
        
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            background: #fdfaf5; 
            text-align: center; 
            margin: 0; 
            padding: 10px;
            overflow: hidden; /* Prevents bouncing/scrolling */
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Header & Score */
        .header { width: 100%; display: flex; justify-content: space-between; padding: 10px 20px; box-sizing: border-box; }
        .lvl-badge { background: var(--primary); color: white; padding: 4px 12px; border-radius: 20px; font-weight: bold; }

        /* The Order Card */
        .order-card { 
            background: white; 
            padding: 15px; 
            border-radius: 15px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
            border-left: 8px solid var(--primary); 
            width: 90%;
            margin: 10px 0;
        }
        #order-title { font-size: 18px; color: #333; display: block; margin-bottom: 5px; }
        #order-details { font-size: 14px; color: #666; font-weight: bold; }

        /* The Platter (Board) */
        .board { 
            width: 300px; 
            min-height: 200px; 
            background: var(--wood); 
            border: 10px solid var(--bark); 
            border-radius: 50px; 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            align-content: center; 
            gap: 12px; 
            padding: 20px;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.2), 0 10px 20px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        /* The Ingredients */
        .tray { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 12px; 
            justify-content: center; 
            padding: 15px; 
            background: rgba(255,255,255,0.6); 
            border-radius: 25px; 
            width: 95%;
            margin-top: auto;
            margin-bottom: 20px;
        }
        .item { 
            font-size: 42px; 
            cursor: pointer; 
            user-select: none; 
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .item:active { transform: scale(1.5); }

        /* Button & Messages */
        button { 
            background: var(--primary); 
            color: white; 
            border: none; 
            padding: 16px 40px; 
            border-radius: 30px; 
            font-weight: bold; 
            font-size: 18px; 
            box-shadow: 0 4px 0 #5a3ec7;
            margin-bottom: 20px;
        }
        button:active { transform: translateY(3px); box-shadow: none; }
        #msg { height: 24px; font-weight: bold; color: var(--primary); margin-bottom: 5px; }

        /* Success Animation */
        .win-bounce { animation: bounce 0.5s ease infinite alternate; }
        @keyframes bounce { from { transform: scale(1); } to { transform: scale(1.05); } }
    </style>
</head>
<body>

    <div class="header">
        <div style="font-weight: 900; color: #333;">üßÄ CHALLENGE</div>
        <div class="lvl-badge" id="lvl-display">Level 1</div>
    </div>

    <div class="order-card">
        <b id="order-title">Loading...</b>
        <div id="order-details"></div>
    </div>

    <div id="msg"></div>

    <div class="board" id="board"></div>
    
    <div class="tray" id="tray"></div>

    <button onclick="submitBoard()">Serve Platter</button>

    <script>
        let currentLevel = 0;
        
        // Full Ingredient Pool
        const allItems = [
            { e: 'üßÄ', t: 'cheese' }, { e: 'üßÄ', t: 'cheese' }, { e: 'üßÄ', t: 'cheese' },
            { e: 'üçá', t: 'fruit' }, { e: 'üçì', t: 'fruit' }, { e: 'üçä', t: 'fruit' },
            { e: 'ü•©', t: 'meat' }, { e: 'ü•ì', t: 'meat' }, { e: 'üçñ', t: 'meat' },
            { e: 'ü•®', t: 'cracker' }, { e: 'üçû', t: 'cracker' },
            { e: 'üç´', t: 'sweet' }, { e: 'üç™', t: 'sweet' },
            { e: 'ü•ú', t: 'nut' }, { e: 'üåø', t: 'garnish' }
        ];

        // 10 Levels of progression
        const levels = [
            { title: "The Office Snack", req: { cheese: 1, cracker: 1 } },
            { title: "Quick Picnic", req: { cheese: 1, fruit: 1, cracker: 1 } },
            { title: "Date Night", req: { cheese: 2, meat: 1, fruit: 1 } },
            { title: "The Trio", req: { meat: 1, cheese: 1, fruit: 1, cracker: 1 } },
            { title: "Meat Lover", req: { meat: 3, cracker: 1 } },
            { title: "Cheese Connoisseur", req: { cheese: 3, fruit: 1 } },
            { title: "Holiday Party", req: { cheese: 2, meat: 2, cracker: 2 } },
            { title: "Sweet & Salty", req: { sweet: 2, nut: 1, cheese: 1 } },
            { title: "The Instagrammer", req: { cheese: 2, fruit: 2, garnish: 1 } },
            { title: "The Ultimate Feast", req: { cheese: 2, meat: 2, fruit: 2, cracker: 2, sweet: 1, nut: 1 } }
        ];

        function init() {
            if (currentLevel >= levels.length) {
                showVictory();
                return;
            }

            const data = levels[currentLevel];
            document.getElementById('lvl-display').innerText = "Level " + (currentLevel + 1);
            document.getElementById('order-title').innerText = data.title;
            
            let details = "";
            for (let k in data.req) {
                details += ` ${data.req[k]}x ${k.toUpperCase()} ‚Ä¢`;
            }
            document.getElementById('order-details').innerText = details.slice(0, -1);

            const tray = document.getElementById('tray');
            const board = document.getElementById('board');
            tray.innerHTML = ''; board.innerHTML = '';
            board.classList.remove('win-bounce');

            allItems.forEach(item => {
                const d = document.createElement('div');
                d.className = 'item';
                d.innerHTML = item.e;
                d.onclick = () => {
                    if (d.parentElement.id === 'tray') board.appendChild(d);
                    else tray.appendChild(d);
                };
                d.setAttribute('data-type', item.t);
                tray.appendChild(d);
            });
        }

        function submitBoard() {
            const data = levels[currentLevel];
            const items = document.querySelectorAll('#board .item');
            let counts = {};
            items.forEach(i => {
                let t = i.getAttribute('data-type');
                counts[t] = (counts[t] || 0) + 1;
            });

            let win = true;
            for (let k in data.req) {
                if ((counts[k] || 0) < data.req[k]) win = false;
            }

            if (win) {
                document.getElementById('msg').innerText = "‚ú® PERFECT PLATTER! ‚ú®";
                document.getElementById('board').classList.add('win-bounce');
                currentLevel++;
                setTimeout(() => { 
                    document.getElementById('msg').innerText = ""; 
                    init(); 
                }, 1800);
            } else {
                document.getElementById('msg').innerText = "‚ùå Missing items!";
                setTimeout(() => { document.getElementById('msg').innerText = ""; }, 1500);
            }
        }

        function showVictory() {
            document.body.innerHTML = `
                <div style="margin-top: 100px;">
                    <h1 style="font-size: 80px; margin: 0;">üèÜ</h1>
                    <h2>PLATTER MASTER</h2>
                    <p>You served all customers!</p>
                    <button onclick="location.reload()">RESTART GAME</button>
                </div>
            `;
        }

        init();

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>
</html>
