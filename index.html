<script>
  let currentLevel = 1;
  
  // 1. ALL ingredients available in the game
  const ingredients = [
    { emoji: 'ğŸ§€', type: 'cheese' }, { emoji: 'ğŸ§€', type: 'cheese' },
    { emoji: 'ğŸ‡', type: 'fruit' }, { emoji: 'ğŸ“', type: 'fruit' },
    { emoji: 'ğŸ«', type: 'sweet' }, { emoji: 'ğŸª', type: 'sweet' },
    { emoji: 'ğŸ¥©', type: 'meat' }, { emoji: 'ğŸ¥“', type: 'meat' },
    { emoji: 'ğŸ¥¨', type: 'cracker' }, { emoji: 'ğŸ¥œ', type: 'nut' }
  ];

  const levels = [
    { title: "The Quick Snack", req: { cheese: 1, fruit: 1, cracker: 1 } },
    { title: "Date Night Platter", req: { cheese: 2, meat: 1, fruit: 1, sweet: 1 } },
    { title: "The Party Board", req: { cheese: 2, meat: 2, cracker: 2, nut: 1, fruit: 1 } }
  ];

  function setupLevel() {
    // Determine level (loop back to last level if they go beyond level 3)
    const levelData = levels[Math.min(currentLevel - 1, levels.length - 1)];
    
    document.getElementById('order-title').innerHTML = `<b>ORDER: ${levelData.title}</b>`;
    document.getElementById('level').innerText = currentLevel;
    
    // Clear the board and tray for the new level
    const tray = document.getElementById('tray');
    const board = document.getElementById('board');
    tray.innerHTML = '';
    board.innerHTML = '';
    
    // 2. IMPORTANT: This loop now correctly places ALL ingredients into the tray
    ingredients.forEach(item => {
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = item.emoji;
      div.dataset.type = item.type;
      
      // Tap to move logic
      div.onclick = () => {
        if (div.parentElement.id === 'tray') {
          board.appendChild(div);
          playTapSound(0.1); // Mini haptic-style sound
        } else {
          tray.appendChild(div);
        }
      };
      tray.appendChild(div);
    });

    // Generate the requirement text
    let reqText = "";
    for (let key in levelData.req) {
      reqText += `â€¢ ${levelData.req[key]} ${key.toUpperCase()} `;
    }
    document.getElementById('order-details').innerText = reqText;
  }

  // A simple "Beep" sound using the browser's synthesizer (No files needed!)
  function playTapSound(vol) {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.type = 'sine';
    osc.frequency.setValueAtTime(600, ctx.currentTime);
    gain.gain.setValueAtTime(vol, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
    osc.start();
    osc.stop(ctx.currentTime + 0.1);
  }

  function submitBoard() {
    const levelData = levels[Math.min(currentLevel - 1, levels.length - 1)];
    const onBoard = document.querySelectorAll('#board .item');
    let counts = {};
    
    onBoard.forEach(item => {
      counts[item.dataset.type] = (counts[item.dataset.type] || 0) + 1;
    });

    let pass = true;
    for (let key in levelData.req) {
      if ((counts[key] || 0) < levelData.req[key]) pass = false;
    }

    if (pass) {
      document.getElementById('msg').innerText = "âœ… Perfect! Next Level...";
      currentLevel++;
      playTapSound(0.5); // Louder sound for success
      setTimeout(() => {
        document.getElementById('msg').innerText = "";
        setupLevel();
      }, 1500);
    } else {
      document.getElementById('msg').innerText = "âŒ Missing something! Check the list.";
    }
  }

  // Initialize the first level
  setupLevel();
</script>
